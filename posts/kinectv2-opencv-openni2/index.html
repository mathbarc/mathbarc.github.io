<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="en"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Capturing data from Kinect v2 using OpenCV" /><meta name="author" content="Matheus Barcelos de Oliveira" /><meta property="og:locale" content="en" /><meta name="description" content="What is Kinect?" /><meta property="og:description" content="What is Kinect?" /><link rel="canonical" href="https://mathbarc.github.io/posts/kinectv2-opencv-openni2/" /><meta property="og:url" content="https://mathbarc.github.io/posts/kinectv2-opencv-openni2/" /><meta property="og:site_name" content="Matheus Barcelos de Oliveira" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-15T10:00:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Capturing data from Kinect v2 using OpenCV" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Matheus Barcelos de Oliveira","url":"https://github.com/mathbarc/"},"dateModified":"2022-09-23T01:36:10-03:00","datePublished":"2022-08-15T10:00:00-03:00","description":"What is Kinect?","headline":"Capturing data from Kinect v2 using OpenCV","mainEntityOfPage":{"@type":"WebPage","@id":"https://mathbarc.github.io/posts/kinectv2-opencv-openni2/"},"url":"https://mathbarc.github.io/posts/kinectv2-opencv-openni2/"}</script><title>Capturing data from Kinect v2 using OpenCV | Matheus Barcelos de Oliveira</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Matheus Barcelos de Oliveira"><meta name="application-name" content="Matheus Barcelos de Oliveira"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Matheus Barcelos de Oliveira</a></div><div class="site-subtitle font-italic">Some ideas and works explored during my studies</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/mathbarc" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/mathbarc/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['matheusbarcelosoliveira','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Capturing data from Kinect v2 using OpenCV</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Capturing data from Kinect v2 using OpenCV</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1660568400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 15, 2022 </em> </span> <span> Updated <em class="" data-ts="1663907770" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 23, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/mathbarc/">Matheus Barcelos de Oliveira</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1143 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h1 id="what-is-kinect">What is Kinect?</h1><p>Kinect is a movement sensor developed for use on Xbox 360 and Xbox One by Prime Sense in a collaboration with Microsoft. The device contains microphones, RGB cameras, infrared emissors and a monocrom√°tic CMOS sensor for sampling infrared. By calibrating the infrared emissor and CMOS sensor it is possible to obtain depth maps and reconstruct the scene.</p><p>The device was created as a natural interface for users to interact with video games without the need for physical controllers. It is capable to detect pose of up to 4 people simultaneously.</p><p>In this article are the steps necessary to access Kinect data using OpenCV on Linux.</p><h1 id="materials">Materials</h1><ul><li><a href="https://produto.mercadolivre.com.br/MLB-2031065410-sensor-kinect-microsoft-xbox-one-original-novo-vitrine-nf-_JM#position=3&amp;search_layout=grid&amp;type=item&amp;tracking_id=30704690-2e9a-4958-a95e-fb457fdb946a">Kinect v2</a><li><a href="https://produto.mercadolivre.com.br/MLB-1895436597-adaptador-kinect-30-conector-xbox-one-x-one-s-windows-10-_JM">Kinect v2 Adapter</a><li>PC with linux</ul><h1 id="dependencies">Dependencies</h1><p>During the wrinting of this article, two operational systems were used: Ubuntu 20.04 and Ubuntu 22.04 and because of that it will be shown the APT commands used to install pre-compiled libraries. For users of other OS it will be show compilation steps for the dependencies.</p><h2 id="openni"><span class="mr-2">OpenNI</span><a href="#openni" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>OpenNI (Open Natural Interaction) is an Open Source project that aims to improve standardization of natural user interfaces. It provides an API that encapsulates hardware details and facilitates integration with applications.</p><p>This library was mainly maintained by PrimeSense, but its original repository was discontinued when the company was bought by Apple in 2013. Since then old partners and employees from PrimeSense made a fork from OpenNI 2 which is currently maintained by StructureIO.</p><ul><li>Repo: <a href="https://github.com/structureio/OpenNI2">https://github.com/structureio/OpenNI2</a><li>APT Commmand: <code class="language-plaintext highlighter-rouge">apt install libopenni2-dev openni2-utils</code></ul><h2 id="opencv"><span class="mr-2">OpenCV</span><a href="#opencv" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>OpenCV (Open Computer Vision) is an Open Source library that reunites computer vision algorithms on different areas: image processing, 3D reconstruction, optimization, clustering, tracking, descriptors, matching, object recognition and deep learning. It has support for multiple programming languages like: C++, python, java e MATLAB.</p><ul><li>Repo: <a href="https://github.com/opencv/opencv">https://github.com/opencv/opencv</a><li>APT Commmand: <code class="language-plaintext highlighter-rouge">apt install libopencv-dev</code></ul><p>The following steps are necessary to compile a version of OpenCV with support to OpenNI2:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>git clone https://github.com/opencv/opencv.git
git clone https://github.com/opencv/opencv_contrib.git
<span class="nb">cd </span>opencv_contrib
git checkout 4.6.0
<span class="nb">cd</span> ../opencv
git checkout 4.6.0
<span class="nb">mkdir </span>build
<span class="nb">cd </span>build
cmake <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release <span class="nt">-DBUILD_TESTING</span><span class="o">=</span>OFF <span class="nt">-DBUILD_PERF_TESTS</span><span class="o">=</span>OFF <span class="nt">-DOPENCV_ENABLE_NONFREE</span><span class="o">=</span>OFF <span class="nt">-DOPENCV_EXTRA_MODULES</span><span class="o">=</span>../opencv_contrib/modules <span class="nt">-DWITH_OPENNI2</span><span class="o">=</span>ON ..
make <span class="nt">-j</span> 4
<span class="nb">sudo </span>make <span class="nb">install</span>
</pre></table></code></div></div><h2 id="pcl"><span class="mr-2">PCL</span><a href="#pcl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>PCL (Point Clout Library) is a C++ library specialized in processing point clouds. It provides implementations of filters, key point selection, surface reconstruction, sensor communication and visualization.</p><ul><li>Reposit√≥rio: <a href="https://github.com/PointCloudLibrary/pcl">https://github.com/PointCloudLibrary/pcl</a><li>Comando APT: <code class="language-plaintext highlighter-rouge">apt install libpcl-dev</code></ul><h1 id="making-it-work">Making it work</h1><p>The libraries in the last session allow high level programming that provides functions to recover and reconstruct 3D data. However, to make them work we firstly need to compile a driver that manages communication between OS and Kinect. To do so it is possible to utilize the project libfreenect, an open source Kinect driver developed mostly for linux but capable of being compiled on windows.</p><p>As the main focus of this article is to utilize the Kinect version 2, on this session the steps necessary to compile and configure the <a href="https://github.com/OpenKinect/libfreenect2">LibFreenect2</a> are shown.</p><h2 id="compiling-libfreenect2"><span class="mr-2">Compiling libfreenect2</span><a href="#compiling-libfreenect2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>git clone https://github.com/OpenKinect/libfreenect2.git
<span class="nb">cd </span>libfreenect2
git checkout v0.2.1
<span class="nb">mkdir </span>build
<span class="nb">cd </span>build
cmake <span class="nt">-DBUILD_OPENNI2_DRIVER</span><span class="o">=</span>ON <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release ..
make <span class="nt">-j</span> 4
<span class="nb">sudo </span>make <span class="nb">install
sudo </span>make install-openni2
</pre></table></code></div></div><h2 id="allow-access-to-device"><span class="mr-2">Allow access to device</span><a href="#allow-access-to-device" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>After compilation and installation of the project, it is necessary to grant users access to Kinect device, otherwise root permission will be needed to capture data from the sensor. It can be done by executing the following commands:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cd </span>libfreenect2
<span class="nb">sudo cp</span> ./platform/linux/udev/90-kinect2.rules /etc/udev/rules.d/
</pre></table></code></div></div><p><strong>It is necessary to disconnect the Kinect sensor from the USB port and reconnect again for changes to take place.</strong></p><h2 id="testing-with-niviewer2"><span class="mr-2">Testing with NiViewer2</span><a href="#testing-with-niviewer2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>After following the steps above the command NiViewer2 can be used to check if the environment is correct configurated:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>openni2-utils <span class="c"># caso n√£o tenha sido instalado ainda</span>
NiViewer2
</pre></table></code></div></div><p>The execution of the above command is expected to look like the following image:</p><p><img data-src="/assets/img/kinect_v2_com_opencv/niviewer2.png" alt="NiViewer Example" title="NiViewer Example" data-proofer-ignore></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>[Info] [Freenect2Impl] enumerating devices...
[Info] [Freenect2Impl] 10 usb devices connected
[Info] [Freenect2Impl] found valid Kinect v2 @2:2 with serial 067886733447
[Info] [Freenect2Impl] found 1 devices
[Info] [Freenect2DeviceImpl] opening...
[Info] [Freenect2DeviceImpl] transfer pool sizes rgb: 20*16384 ir: 60*8*33792
[Info] [Freenect2DeviceImpl] opened
[Info] [Freenect2DeviceImpl] starting...
[Info] [Freenect2DeviceImpl] submitting rgb transfers...
[Info] [Freenect2DeviceImpl] submitting depth transfers...
[Info] [Freenect2DeviceImpl] started
[Info] [DepthPacketStreamParser] 32 packets were lost
[Info] [DepthPacketStreamParser] 13 packets were lost
[Info] [TurboJpegRgbPacketProcessor] avg. time: 9.53263ms -&gt; ~104.903Hz
</pre></table></code></div></div><h1 id="program-sample">Program Sample</h1><p>If the environment is correct configured, on this section is provided a sample code using OpenCV to capture data from sensor and PCL to visualize the point cloud. After compiling and executing the program it is expected a view like the video of the last session.</p><h2 id="source-code"><span class="mr-2">Source Code</span><a href="#source-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-cmake highlighter-rouge"><div class="code-header"> <span data-label-text="Cmake"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nb">find_package</span><span class="p">(</span>OpenCV 4 COMPONENTS core highgui videoio imgcodecs<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span><span class="si">${</span><span class="nv">OpenCV_FOUND</span><span class="si">}</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
        <span class="nb">find_package</span><span class="p">(</span>OpenCV 2 COMPONENTS core highgui REQUIRED<span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>


<span class="nb">find_package</span><span class="p">(</span>PCL COMPONENTS visualization REQUIRED<span class="p">)</span>

<span class="nb">set</span><span class="p">(</span>OPENNI_CAPTURE_INCLUDE_DIRS 
	<span class="si">${</span><span class="nv">OpenCV_INCLUDE_DIRS</span><span class="si">}</span>
  <span class="si">${</span><span class="nv">PCL_INCLUDE_DIRS</span><span class="si">}</span>
<span class="p">)</span>

<span class="nb">file</span><span class="p">(</span>GLOB OPENNI_CAPTURE_SOURCES main.cpp<span class="p">)</span>
<span class="nb">include_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">OPENNI_CAPTURE_INCLUDE_DIRS</span><span class="si">}</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>openni-capture <span class="si">${</span><span class="nv">OPENNI_CAPTURE_SOURCES</span><span class="si">}</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>openni-capture <span class="si">${</span><span class="nv">OpenCV_LIBS</span><span class="si">}</span> <span class="si">${</span><span class="nv">PCL_LIBRARIES</span><span class="si">}</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;opencv2/core/core.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;opencv2/highgui/highgui.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;opencv2/imgproc/imgproc.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;pcl/visualization/cloud_viewer.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span>
<span class="n">cv</span><span class="o">::</span><span class="n">VideoCapture</span> <span class="nf">cap</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">CAP_OPENNI2</span><span class="p">);</span> <span class="c1">// Configures cv::VideoCapture to open device 1 using OpenNI2</span>

<span class="kt">void</span> <span class="nf">getPointCloud</span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="o">&amp;</span> <span class="n">viewer</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">viewer</span><span class="p">.</span><span class="n">removeAllPointClouds</span><span class="p">();</span> <span class="c1">// Cleans previous point cloud on view</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">pointCloudFrame</span><span class="p">,</span> <span class="n">frame</span><span class="p">;</span>

    <span class="n">cap</span><span class="p">.</span><span class="n">grab</span><span class="p">();</span> <span class="c1">// Grabs a sensor reading</span>
    <span class="n">cap</span><span class="p">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">pointCloudFrame</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">CAP_OPENNI_POINT_CLOUD_MAP</span><span class="p">);</span> <span class="c1">// Recovers point cloud on matrix format from sensor data</span>
    <span class="n">cap</span><span class="p">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">CAP_OPENNI_BGR_IMAGE</span><span class="p">);</span> <span class="c1">// Obtains color information aligned with point cloud</span>

    <span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">CloudViewer</span><span class="o">::</span><span class="n">ColorCloud</span><span class="o">*</span> <span class="n">cloud</span> <span class="o">=</span> <span class="k">new</span> <span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">CloudViewer</span><span class="o">::</span><span class="n">ColorCloud</span><span class="p">();</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">pointCloudFrame</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="c1">// For each point on the matrix</span>
    <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">pointCloudFrame</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="c1">// For each point on the matrix</span>
        <span class="p">{</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span> <span class="n">color</span> <span class="o">=</span> <span class="n">frame</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span> <span class="c1">// Gets point color </span>
            <span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZRGB</span> <span class="n">point</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// Creates a PCL point containing color</span>

            <span class="n">cv</span><span class="o">::</span><span class="n">Vec3f</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">pointCloudFrame</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3f</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span> <span class="c1">// Gets X,Y,Z position of point</span>
            <span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// Sets coodinate on point</span>
            <span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// Sets coodinate on point</span>
            <span class="n">point</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// Sets coodinate on point</span>

            <span class="n">cloud</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">point</span><span class="p">);</span> <span class="c1">// Adds point on point cloud</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">viewer</span><span class="p">.</span><span class="n">addPointCloud</span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">CloudViewer</span><span class="o">::</span><span class="n">ColorCloud</span><span class="o">::</span><span class="n">ConstPtr</span><span class="p">(</span><span class="n">cloud</span><span class="p">));</span> <span class="c1">// Sends a point cloud to be rendered on screen</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cap</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span>
       <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">cap</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_OPENNI_DEPTH_GENERATOR_REGISTRATION</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Configures OpenNI to generate point clouds with color information</span>

    <span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">CloudViewer</span> <span class="n">viewer</span><span class="p">(</span><span class="s">"point cloud"</span><span class="p">);</span> <span class="c1">// Initializes a Point Cloud Viewer interface</span>
    <span class="n">viewer</span><span class="p">.</span><span class="n">runOnVisualizationThread</span><span class="p">(</span><span class="n">getPointCloud</span><span class="p">);</span> <span class="c1">// Defines callback function to render scene</span>

    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">viewer</span><span class="p">.</span><span class="n">wasStopped</span><span class="p">());</span> <span class="c1">// Waits for window closure</span>

    <span class="n">cap</span><span class="p">.</span><span class="n">release</span><span class="p">();</span> <span class="c1">// Closes communication with device</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</pre></table></code></div></div><h2 id="result"><span class="mr-2">Result</span><a href="#result" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div style="position:relative;width:100%;padding-bottom:56.25%"> <iframe style="position:absolute;top:0;left:0;width:100%;height:100%;border:0" src="https://www.youtube.com/embed/199c-im-FOM" allowfullscreen=""></iframe></div><div><h3><p>In case of any doubts or ideas send me a <a href="mailto:matheusbarcelosoliveira@gmail.com">email</a>,</p><p><a href="https://github.com/mathbarc">Matheus Barcelos de Oliveira</a><br /> Computer Engineer</p></h3></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/3d-reconstruction/'>3D Reconstruction</a>, <a href='/categories/lidar/'>LiDAR</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kinect/" class="post-tag no-text-decoration" >kinect</a> <a href="/tags/opencv/" class="post-tag no-text-decoration" >opencv</a> <a href="/tags/pcl/" class="post-tag no-text-decoration" >pcl</a> <a href="/tags/openni/" class="post-tag no-text-decoration" >openni</a> <a href="/tags/3d/" class="post-tag no-text-decoration" >3d</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmathbarc.github.io%2Fposts%2Fkinectv2-opencv-openni2%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmathbarc.github.io%2Fposts%2Fkinectv2-opencv-openni2%2F&text=Capturing+data+from+Kinect+v2+using+OpenCV+-+Matheus+Barcelos+de+Oliveira" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Capturing+data+from+Kinect+v2+using+OpenCV+-+Matheus+Barcelos+de+Oliveira&u=https%3A%2F%2Fmathbarc.github.io%2Fposts%2Fkinectv2-opencv-openni2%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://twitter.com/intent/tweet?text=Capturing+data+from+Kinect+v2+using+OpenCV+-+Matheus+Barcelos+de+Oliveira&url=https%3A%2F%2Fmathbarc.github.io%2Fposts%2Fkinectv2-opencv-openni2%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/using-esp32-for-speech-recognition/">Using ESP32 for Speech Recognition</a><li><a href="/posts/kinectv2-opencv-openni2/">Capturing data from Kinect v2 using OpenCV</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/3d/">3d</a> <a class="post-tag" href="/tags/esp/">esp</a> <a class="post-tag" href="/tags/iot/">iot</a> <a class="post-tag" href="/tags/kinect/">kinect</a> <a class="post-tag" href="/tags/messaging/">messaging</a> <a class="post-tag" href="/tags/opencv/">opencv</a> <a class="post-tag" href="/tags/openni/">openni</a> <a class="post-tag" href="/tags/pcl/">pcl</a> <a class="post-tag" href="/tags/speech-recognition/">speech recognition</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/using-esp32-for-speech-recognition/"><div class="card-body"> <em class="small" data-ts="1593435600" data-df="ll" > Jun 29, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using ESP32 for Speech Recognition</h3><div class="text-muted small"><p> This article will present steps to utilize ESP32 in cotrolling a lamp using voice commands. Supplies A ESP32 device: Mercado Livre, Amazon; A Relay with 5v trigger: Mercado Livre, Amazon; ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/using-esp32-for-speech-recognition/" class="btn btn-outline-primary" prompt="Older"><p>Using ESP32 for Speech Recognition</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://github.com/mathbarc">Matheus Barcelos de Oliveira</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/3d/">3d</a> <a class="post-tag" href="/tags/esp/">esp</a> <a class="post-tag" href="/tags/iot/">iot</a> <a class="post-tag" href="/tags/kinect/">kinect</a> <a class="post-tag" href="/tags/messaging/">messaging</a> <a class="post-tag" href="/tags/opencv/">opencv</a> <a class="post-tag" href="/tags/openni/">openni</a> <a class="post-tag" href="/tags/pcl/">pcl</a> <a class="post-tag" href="/tags/speech-recognition/">speech recognition</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-N0063509P2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-N0063509P2'); }); </script>
